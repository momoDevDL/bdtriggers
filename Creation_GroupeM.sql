
/*
Fichier : Creation_GroupeM.sql
Auteurs : 
Antoine AFFLATET 
Mohamed MASBAH ABOU LAICH 21611213
Nom du groupe : M
*/

/*
A METTTRE OBLIGATOIREMENT AU DEBUT 
- SUPPRESSION DE LA BASE DE DONNEES
- CREATION DE LA BASE DE DONNEES
- SUPPRESSIONS DE TOUTES LES BASES CREEES POUR LE PROJET
*/


DROP DATABASE IF EXISTS MyEvents;
CREATE DATABASE  MyEvents;
USE MyEvents;

/*
Création de la base de  données
*/

DROP TABLE IF EXISTS UTILISATEUR;
DROP TABLE IF EXISTS THEMES;
DROP TABLE IF EXISTS EVENEMENTS;
DROP TABLE IF EXISTS INSCRIT;
DROP TABLE IF EXISTS AJOUT_CONTRIB;
-- **************************************   UTILISATEUR  
/**/

CREATE TABLE   UTILISATEUR  
(
   U_ID            VARCHAR(45)  NOT NULL,
   ROLE            VARCHAR(45) NOT NULL, /* 3 ROLES SEULEMENT : admin / contributeur / visiteur*/
   PSEUDO	   VARCHAR(45) NOT NULL,
   EMAIL           varchar(150) NOT NULL ,
   DATE_NAISSANCE  DATE         NOT NULL,
   PASSWORD        VARCHAR(45) NOT NULL,
   STATUT          VARCHAR(45) NOT NULL,

CONSTRAINT USR_PK PRIMARY KEY ( U_ID )

);

-- **************************************  CONTRIBUTEUR 

CREATE TABLE  AJOUT_CONTRIB 
(
  C_ID         VARCHAR(45)  NOT NULL ,
  ADMIN_ID     VARCHAR(45)  NOT NULL ,

CONSTRAINT CONTRIB_PK PRIMARY KEY ( C_ID,ADMIN_ID ),
CONSTRAINT  CONTRIB_ID_FK FOREIGN KEY( C_ID ) REFERENCES  UTILISATEUR  ( U_ID ),
CONSTRAINT  CONTRIB_ADMIN_ID_FK FOREIGN KEY( ADMIN_ID ) REFERENCES  UTILISATEUR  ( U_ID )
);


/*
-- **************************************   VISITEUR  

CREATE TABLE   VISITEUR  
(
   V_ID   numeric NOT NULL ,
   
CONSTRAINT VISIT_PK PRIMARY KEY ( V_ID ),
CONSTRAINT VISIT_ID_FK FOREIGN KEY(  V_ID  ) REFERENCES   UTILISATEUR   (  U_ID  )

);



-- **************************************  ADMIN 

CREATE TABLE  ADMINISTRATEUR 
(
  A_ID  numeric NOT NULL ,

CONSTRAINT ADMIN_PK PRIMARY KEY ( A_ID ),
CONSTRAINT  ADMIN_FK FOREIGN KEY ( A_ID ) REFERENCES  UTILISATEUR  ( U_ID )
);
*/

-- **************************************  COMPTES 

/*CREATE TABLE  COMPTES 
(
  ID_COMPTE   INT(11) NOT NULL AUTO_INCREMENT ,
  USER_ACCOUNT_ID INT(11)  NOT NULL,
  PASSWORD  varchar(45) NOT NULL ,
  
CONSTRAINT COMPTES_PK PRIMARY KEY ( ID_COMPTE ),
CONSTRAINT  COMPTES_USR_FK FOREIGN KEY ( USER_ACCOUNT_ID ) REFERENCES  UTILISATEUR  ( U_ID )
);*/


-- **************************************   THEME  

CREATE TABLE   THEME  
(
   ID_THEME      varchar(45) NOT NULL ,
   NOM           varchar(45) NOT NULL ,

CONSTRAINT THEME_PK PRIMARY KEY ( ID_THEME )
);



-- **************************************  EVENEMENTS 
/* ON CONSIDERE QUE SI  LE NOMBRE DE PLACE EST NULL 
LE NOMBRE DE PLACE EN VRAI EST ILLIMITÉ*/

CREATE TABLE EVENEMENTS
(
  E_ID             varchar(45) NOT NULL ,
  CREATEUR_ID      VARCHAR(45) NOT NULL ,
  TITRE_EVENEMENTS  varchar(45) NOT NULL ,
  ADRESSE           varchar(45) NOT NULL ,
  DATE_DEBUT        date NOT NULL ,
  DATE_FIN          date NOT NULL ,
  NBR_DE_PLACE      NUMERIC,
  AGE_MINIMUM       NUMERIC ,
  ID_THEME          varchar(45) NOT NULL ,


CONSTRAINT EVENT_PK PRIMARY KEY ( E_ID ),

CONSTRAINT  THEME_EVT_FK  FOREIGN KEY ( ID_THEME ) REFERENCES  THEME( ID_THEME ),
CONSTRAINT  CREATOR_EVT_FK  FOREIGN KEY ( CREATEUR_ID ) REFERENCES UTILISATEUR ( U_ID )
);


CREATE TABLE  INSCRIT 
(	
  ID_USER   VARCHAR(45)  NOT NULL ,
  ID_EVENEMENT varchar(45) NOT NULL ,

CONSTRAINT INSCRIT_PK PRIMARY KEY ( ID_USER,ID_EVENEMENT),
CONSTRAINT  INSCRIT_USR_FK FOREIGN KEY ( ID_USER ) REFERENCES  UTILISATEUR  ( U_ID ),
CONSTRAINT  INSCRIT_EVENT_FK FOREIGN KEY ( ID_EVENEMENT ) REFERENCES  EVENEMENTS  ( E_ID )

);

CREATE TABLE LOGERROR  (
  ID INT(11) AUTO_INCREMENT,
  MESSAGE VARCHAR(255) DEFAULT NULL,
  THETIME TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT PK_LOGERROR PRIMARY KEY (ID)
);	



/* ------------------------------------
Insertion de tuples dans les relations
--------------------------------------*/
 

INSERT INTO UTILISATEUR (U_ID,ROLE,PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT) VALUES ('SENTES','ADMIN','SENTES','antoine.afflatet@gmail.com','1998-05-03',md5('HALELLUJAH'),'ADMIN');
INSERT INTO UTILISATEUR ( U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('MOMOMAN852','ADMIN','MOMOMOAN852','momo.man@gmail.com','1898-10-07',md5('HALELLUJAH'),'ADMIN');
INSERT INTO UTILISATEUR (U_ID, ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('RYU','CONTRIBUTEUR','RYU','RYU.PAJ@gmail.com','1982-05-28',md5('HALELLUJAH'),'NOVICE');
INSERT INTO UTILISATEUR (U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('TANAKA', 'CONTRIBUTEUR','TANAKA','TANA.KA@gmail.com','1998-11-09',md5('HALELLUJAH'),'NOVICE');
INSERT INTO UTILISATEUR ( U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('GON','CONTRIBUTEUR','GON','GON.HUNTER@gmail.com','1998-12-03',md5('HALELLUJAH'),'NOVICE');
INSERT INTO UTILISATEUR ( U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('KARIMON','VISITEUR','KARIMON','kari.mon@gmail.com','1999-02-22',md5('HALELLUJAH'),'NOVICE');
INSERT INTO UTILISATEUR ( U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('DORAIMON4585','VISITEUR','DORAIMON','dora.imon@gmail.com','1998-11-21',md5('HALELLUJAH'),'NOVICE');
INSERT INTO UTILISATEUR ( U_ID,ROLE , PSEUDO , EMAIL,DATE_NAISSANCE,PASSWORD,STATUT ) VALUES ('SALEH','VISITEUR','dass','saleh.dassouki@gmail.com','2000-12-28',md5('HALELLUJAH'),'NOVICE');

INSERT INTO AJOUT_CONTRIB(C_ID,ADMIN_ID) SELECT U2.U_ID,U1.U_ID FROM UTILISATEUR U1,UTILISATEUR U2 WHERE U1.U_ID = 'MOMOMAN852' AND U2.ROLE = 'CONTRIBUTEUR';

/*INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (1,md5('ADMIN'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (2,md5('ADMIN'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (3,md5('CONTRIBUTEUR'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (4,md5('CONTRIBUTEUR'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (5,md5('CONTRIBUTEUR'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (6,md5('VISITEUR'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (7,md5('VISITEUR'));
INSERT INTO COMPTES( USER_ACCOUNT_ID , PASSWORD ) VALUES (8,md5('VISITEUR'));*/


INSERT INTO THEME VALUES ('1','CULTURE');
INSERT INTO THEME VALUES ('2','SPORT');


INSERT INTO EVENEMENTS VALUES ('1','RYU','VISITE DE MUSEE','MONTPELLIER','2019-11-08','2019-11-10',NULL,NULL,'1');
INSERT INTO EVENEMENTS VALUES ('2','GON','VISITE DE MUSEE','PARIS','2019-12-24','2019-12-24',8,10,'1');

INSERT INTO EVENEMENTS VALUES ('3','GON','TOURNOI DE FOOT','MONTPELLIER','2020-01-01','2020-01-02',NULL,18,'2');


INSERT INTO INSCRIT(ID_USER,ID_EVENEMENT) VALUES ('SALEH','1');
INSERT INTO INSCRIT(ID_USER,ID_EVENEMENT) VALUES ('DORAIMON4585','3');
INSERT INTO INSCRIT(ID_USER,ID_EVENEMENT) VALUES ('KARIMON','1');



/* ------------------------------------
Affichages des tuples 
--------------------------------------*/
SELECT * FROM UTILISATEUR;
SELECT * FROM AJOUT_CONTRIB;
SELECT * FROM THEME;
SELECT * FROM EVENEMENTS;
SELECT * FROM INSCRIT;


/*------------------------------------- 
Définion de triggers
--------------------------------------*/
